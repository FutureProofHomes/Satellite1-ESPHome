substitutions:
  node_name: mic_udp_streamer
  built_for_core_hw_version: "3"

packages:
  device_base: !include common/board.yaml
  wifi: !include common/wifi_improv.yaml
  local: !include common/local_components.yaml
  vk: !include common/nabu_vk_duplex_r3.yaml
  dummy: !include common/dummy.yaml

logger:
  deassert_rts_dtr: true
  hardware_uart : USB_SERIAL_JTAG
  level: VERBOSE

api:
  id: api_id
  on_client_connected:
    - lambda: id(init_in_progress) = false;
    - script.execute: control_leds
  on_client_disconnected:
    - script.execute: control_leds

udp_stream:
  #use ip address of this machine if not set
  #ip_address: 

switch:
  - platform: template
    name: Stream Mic via UDP
    id: stream_mic_udp
    optimistic: true
    restore_mode: RESTORE_DEFAULT_OFF
    icon: mdi:assistant
    
    on_turn_on:
      - logger.log: "switch udp stream on"
      - udp_stream.start
      
    on_turn_off:
      - logger.log: "switch udp stream off"
      - udp_stream.stop

